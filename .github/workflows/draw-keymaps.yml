# Draw ZMK keymaps using keymap-drawer
name: Draw ZMK keymaps

on:
  workflow_dispatch:  # can be triggered manually
  push:               # automatically run on changes to following paths
    paths:
      - "config/*.keymap"
      - "config/*.dtsi"
      - "keymap_drawer.config.yaml"

jobs:
  draw:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Install uv
        uses: astral-sh/setup-uv@v5
      
      - name: Parse and draw keymap
        run: |
          mkdir -p keymap-drawer
          
          # Parse keymap
          if [ -f "keymap_drawer.config.yaml" ]; then
            uvx --from keymap-drawer keymap -c keymap_drawer.config.yaml parse -z config/glove80.keymap > keymap-drawer/glove80.yaml
          else
            uvx --from keymap-drawer keymap parse -z config/glove80.keymap > keymap-drawer/glove80.yaml
          fi
          
          # Draw SVG
          if [ -f "keymap_drawer.config.yaml" ]; then
            uvx --from keymap-drawer keymap -c keymap_drawer.config.yaml draw keymap-drawer/glove80.yaml > keymap-drawer/glove80.svg
          else
            uvx --from keymap-drawer keymap draw keymap-drawer/glove80.yaml > keymap-drawer/glove80.svg
          fi
      
      - name: Upload keymap artifacts
        uses: actions/upload-artifact@v4
        with:
          name: keymap-visualization
          path: keymap-drawer/
